CREATE DATABASE SUPPLIER;
USE SUPPLIER;

CREATE TABLE SUPPLIER(
   SID INT,
   SNAME VARCHAR(20),
   CITY VARCHAR(20),
   PRIMARY KEY(SID));
   
CREATE TABLE PARTS(
   PID INT,
   PNAME VARCHAR(20),
   COLOR VARCHAR(10),
   PRIMARY KEY(PID));
   
CREATE TABLE CATALOG(
   SID INT,
   PID INT,
   COST REAL,
   FOREIGN KEY(SID) REFERENCES SUPPLIER(SID),
   FOREIGN KEY(PID) REFERENCES PARTS(PID));
   
INSERT INTO SUPPLIER(SID,SNAME,CITY) VALUES
(10001,'Acme Widget','Bangalore'),
(10002,'Johns','Kolkata'),
(10003,'Vimal','Mumbai'),
(10004,'Reliance','Delhi');

INSERT INTO PARTS(PID,PNAME,COLOR) VALUES
(20001,'Book','Red'),
(20002,'Pen','Red'),
(20003,'Pencil','Green'),
(20004,'Mobile','Green'),
(20005,'Charger','Black');

INSERT INTO CATALOG(SID,PID,COST) VALUES
(10001,20001,10),
(10001,20002,10),
(10001,20003,30),
(10001,20004,10),
(10001,20005,10),
(10002,20001,10),
(10002,20002,20),
(10003,20003,30),
(10004,20003,40);

SELECT DISTINCT PNAME FROM PARTS P JOIN CATALOG C ON C.PID=P.PID ORDER BY PNAME ASC;

SELECT S.SNAME FROM SUPPLIER S
WHERE NOT EXISTS (
    SELECT P.PID FROM PARTS P
    WHERE P.PID NOT IN (
        SELECT C.PID FROM CATALOG C
        WHERE C.SID=S.SID
    )
);

SELECT S.SNAME FROM SUPPLIER S
WHERE NOT EXISTS (
    SELECT P.PID FROM PARTS P
    WHERE P.COLOR='Red' AND P.PID NOT IN (
        SELECT C.PID FROM CATALOG C
        WHERE C.SID=S.SID
    )
);

SELECT P.PNAME FROM PARTS P
JOIN CATALOG C ON P.PID=C.PID
JOIN SUPPLIER S ON S.SID=C.SID
WHERE S.SNAME = 'Acme Widget' AND P.PID NOT IN (
      SELECT C2.PID FROM CATALOG C2
      JOIN SUPPLIER S2 ON S2.SID=C2.SID
      WHERE S2.SNAME !='Acme Widget'
  );
  
SELECT DISTINCT C.SID FROM CATALOG C
WHERE C.COST > (
    SELECT AVG(C2.COST) FROM CATALOG C2
    WHERE C2.PID=C.PID
);

SELECT P.PID, S.SNAME FROM PARTS P
JOIN CATALOG C ON P.PID=C.PID
JOIN SUPPLIER S ON S.SID=C.SID
WHERE C.COST = (
    SELECT MAX(C2.COST) FROM CATALOG C2
    WHERE C2.PID=P.PID
);

   